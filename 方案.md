# node 服务端渲染方案

服务端渲染是指当用户请求页面时，利用node在服务端利用模板语言，生成所需页面，交给客户端


## 为什么要服务端渲染

在许多网站中都使用了传统的服务端给出layout，客户端通过js向服务端发送ajax请求获取内容，并渲染到页面上，
相对于传统方案，服务端渲染有一下优点：

1. SEO:由于使用ajax动态生成页面主体，导致搜索引擎无法获取内容，不利于SEO
2. 减少等待时间:对于客户端渲染的页面，利用ajax请求需要等待时间，特别是对于react,vue,angular2等MV*框架下的页面，会出现较长的白屏时间
3. 对低性能客户端支持好
<!--4. 对于相同请求，node可以利用事件订阅机制，使得同一时间的大量请求共享同一渲染结果，为大并发量请求提供缓冲 -->

服务端渲染的弊端:

1. 服务器负载大

2. 服务端渲染时，当服务端获取数据时，一个请求的阻塞会导致整个页面无法及时渲染出来
 
## 如何实现服务端渲染

code:

    let status = 'ready';
    let trunk = '启动server时渲染第一次||第一个请求直接等渲染，渲染时间内的其余请求';

    router.get('/',async (ctx,next)=>{
        ctx.body = trunk;
        if(status == 'ready'){
            status = 'pending';
            //渲染模板 str   
            //trunk = str;模板交付给trunk
            status = 'ready';
        }
        await next();
    })

Q1：高并发状态，同时10000个请求会导致10000次模板渲染，CPU负载过高；
Q2：在模板渲染过程中，node向后端请求数据，一个请求的延迟会导致整个页面渲染的延迟；
A：服务端HTML直出，不管是利用react还是其他模板，
都在服务端生成，现在初步想法是在内存中做了一个缓存，通过status来判断是否ready，
什么时候ready的条件可以自己定，比如正在渲染时status就是pending，
渲染好后就是ready，并交个trunk，保证同一时间内无论多少请求，服务端只渲染一个HTML，
每个请求都会从trunk中取，对于请求最多延迟一个模板渲染的时间

Q3：如何解决第一次渲染时间内的请求
A： 


## 知识储备

## 实现方案

## 实例

## 潜在问题及解决方案

## 思考nihaode